# Deployment Guide: Vercel (Frontend) + Render (Backend)

This guide will help you deploy your QuickCheck application with the frontend on Vercel and the backend on Render.

## 📋 Prerequisites

- [Vercel Account](https://vercel.com/) (free tier available)
- [Render Account](https://render.com/) (free tier available)
- [GitHub Account](https://github.com/) (for code repository)
- Your codebase pushed to a GitHub repository

## 🔧 Architecture Overview

```
Frontend (Vercel) ←→ Backend (Render) + PostgreSQL Database
```

- **Frontend**: Static React app served by Vercel's CDN
- **Backend**: Node.js Express server on Render with PostgreSQL database
- **Database**: PostgreSQL database hosted on Render
- **File Storage**: Static files served by the backend

## 🚀 Step 1: Prepare Your Repository

1. **Push your code to GitHub** (if not already done):
   ```bash
   git add .
   git commit -m "Prepare for Vercel/Render deployment"
   git push origin main
   ```

2. **Verify deployment files** are in your repository:
   - `vercel.json` ✅
   - `render.yaml` ✅
   - `server/database-config.js` ✅
   - `deployment.config.example.js` ✅

## 🌐 Step 2: Deploy Backend to Render

### 2.1 Create Render Service

1. **Login to Render** and go to your dashboard
2. **Click "New +"** → **"Blueprint"**
3. **Connect your GitHub repository**
4. **Select your repository** and click "Connect"
5. Render will automatically detect the `render.yaml` file

### 2.2 Configure Environment Variables

The `render.yaml` file automatically sets up most variables, but verify these in your Render dashboard:

```bash
NODE_ENV=production
JWT_SECRET=(auto-generated by Render)
PORT=10000
DATABASE_TYPE=postgresql
DATABASE_URL=(auto-connected to database)
FRONTEND_URL=https://your-vercel-app.vercel.app  # Update this after Vercel deployment
```

### 2.3 Database Setup

Render will automatically create a PostgreSQL database based on `render.yaml`. The database connection string will be automatically injected as `DATABASE_URL`.

### 2.4 Deploy

1. **Review the blueprint** and click "Apply"
2. **Wait for deployment** (usually 5-10 minutes)
3. **Note your backend URL**: `https://your-app-name.onrender.com`

### 2.5 Verify Backend Deployment

Visit `https://your-app-name.onrender.com/api/health` - you should see a health check response.

## 🎯 Step 3: Deploy Frontend to Vercel

### 3.1 Connect Repository to Vercel

1. **Login to Vercel** and go to your dashboard
2. **Click "New Project"**
3. **Import your GitHub repository**
4. **Configure the project**:
   - **Framework Preset**: Vite
   - **Root Directory**: `.` (leave as default)
   - **Build Command**: `npm run build`
   - **Output Directory**: `dist`

### 3.2 Configure Environment Variables

In Vercel project settings → Environment Variables, add:

```bash
VITE_API_BASE_URL=https://your-render-app.onrender.com
VITE_UPLOAD_URL=https://your-render-app.onrender.com/uploads
```

### 3.3 Deploy

1. **Click "Deploy"**
2. **Wait for build and deployment** (usually 2-5 minutes)
3. **Note your frontend URL**: `https://your-project.vercel.app`

### 3.4 Update Backend CORS

1. **Go back to Render dashboard**
2. **Update the FRONTEND_URL environment variable** with your actual Vercel URL:
   ```bash
   FRONTEND_URL=https://your-project.vercel.app
   ```
3. **Redeploy the backend** (Render will auto-redeploy)

## 🗄️ Step 4: Database Migration (If Migrating from SQLite)

If you have existing data in SQLite, you'll need to migrate it to PostgreSQL:

### 4.1 Export SQLite Data (Local)

```bash
# In your local development environment
cd server
node -e "
const DatabaseConfig = require('./database-config');
const config = new DatabaseConfig();
config.exportSQLiteData().then(data => {
  require('fs').writeFileSync('export-data.json', JSON.stringify(data, null, 2));
  console.log('Data exported to export-data.json');
});
"
```

### 4.2 Import to PostgreSQL

Create a migration script or manually import the data through your application's admin interface.

## 🔒 Step 5: Security Configuration

### 5.1 JWT Secret

Render automatically generates a secure JWT secret. Verify it's been set in your environment variables.

### 5.2 CORS Configuration

The backend is already configured to accept requests from:
- Your Vercel domain
- Any `*.vercel.app` domain (for preview deployments)

### 5.3 HTTPS

Both Vercel and Render provide HTTPS by default. Your application will be served over HTTPS.

## 🧪 Step 6: Testing Your Deployment

### 6.1 Frontend Tests

1. **Visit your Vercel URL**
2. **Test user registration/login**
3. **Verify API calls work** (check browser Network tab)
4. **Test file uploads**
5. **Test PWA installation** (Add to Home Screen)

### 6.2 Backend Tests

1. **Visit backend health endpoint**: `https://your-render-app.onrender.com/api/health`
2. **Test API endpoints** using your frontend
3. **Check backend logs** in Render dashboard

### 6.3 Database Tests

1. **Create a test record** through your frontend
2. **Verify data persistence** by refreshing and checking if data remains
3. **Test file uploads** and verify files are accessible

## 🚨 Common Issues & Solutions

### Issue: CORS Errors
**Solution**: Verify `FRONTEND_URL` in Render matches your exact Vercel URL

### Issue: API Calls Failing
**Solution**: Check `VITE_API_BASE_URL` in Vercel matches your Render backend URL

### Issue: File Uploads Not Working
**Solution**: Verify `VITE_UPLOAD_URL` is correctly set and backend file storage is working

### Issue: Database Connection Errors
**Solution**: Check database status in Render dashboard and verify `DATABASE_URL` is set

### Issue: Build Failures
**Solution**: Check build logs in respective platforms and verify all dependencies are listed in `package.json`

## 🔄 Step 7: Automatic Deployments

### 7.1 Vercel Auto-Deploy

Vercel automatically deploys when you push to your main branch. No additional setup needed.

### 7.2 Render Auto-Deploy

Render automatically deploys when you push to your main branch. You can configure this in the Render dashboard.

### 7.3 Environment-Specific Branches

Consider setting up:
- `main` branch → Production deployments
- `develop` branch → Staging deployments (create separate Vercel/Render services)

## 📊 Step 8: Monitoring & Maintenance

### 8.1 Vercel Analytics

Enable Vercel Analytics in your project dashboard for frontend performance monitoring.

### 8.2 Render Monitoring

Monitor your backend performance and logs through the Render dashboard.

### 8.3 Database Maintenance

- **Regular backups**: Render provides automatic backups
- **Performance monitoring**: Check database metrics in Render dashboard
- **Scaling**: Upgrade database plan as needed

## 💰 Cost Considerations

### Free Tier Limitations

**Vercel Free Tier**:
- 100GB bandwidth/month
- 100 deployments/month
- Custom domains included

**Render Free Tier**:
- 750 hours/month (enough for one always-on service)
- 500MB database storage
- Services spin down after 15 minutes of inactivity

### Scaling Recommendations

For production use, consider upgrading to paid plans for:
- **Vercel Pro**: Unlimited bandwidth, team collaboration
- **Render Starter**: Always-on services, more database storage, better performance

## 🔧 Local Development Setup

For local development with this deployment setup:

```bash
# Frontend (will connect to local backend)
npm run dev:frontend

# Backend (will use SQLite locally)
npm run dev:backend
```

The application automatically detects the environment and uses:
- **Development**: SQLite database, local HTTPS
- **Production**: PostgreSQL database, cloud deployment

## 📞 Support & Troubleshooting

### Getting Help

1. **Check platform status pages**:
   - [Vercel Status](https://vercel-status.com/)
   - [Render Status](https://status.render.com/)

2. **Review logs**:
   - Vercel: Build logs in deployment details
   - Render: Runtime logs in service dashboard

3. **Community resources**:
   - [Vercel Community](https://github.com/vercel/vercel/discussions)
   - [Render Community](https://community.render.com/)

### Quick Debugging Commands

```bash
# Test API connectivity
curl https://your-render-app.onrender.com/api/health

# Check frontend environment variables
console.log('API URL:', import.meta.env.VITE_API_BASE_URL);

# Check backend environment variables (in server logs)
console.log('Frontend URL:', process.env.FRONTEND_URL);
```

---

🎉 **Congratulations!** Your QuickCheck application is now deployed on Vercel and Render with a scalable, production-ready architecture. 